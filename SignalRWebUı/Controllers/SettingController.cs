using MailKit.Net.Smtp;
using Microsoft.AspNetCore.Identity;
using Microsoft.AspNetCore.Mvc;
using MimeKit;
using SignalREntityLayer.Entities;
using SignalRWebUı.Dtos.IdentityDtos;
using System.Text;

namespace SignalRWebUı.Controllers
{
    public class SettingController : Controller
    {
        private readonly UserManager<AppUser> _userManager;

        public SettingController(UserManager<AppUser> userManager)
        {
            _userManager = userManager;
        }

        [HttpGet]
        public async Task<IActionResult> Index()
        {
            var values = await _userManager.FindByNameAsync(User.Identity.Name);
            var UserEdit = new UserEditDto()
            {
                Name = values.Name,
                Surname = values.SurName,
                Mail = values.Email,
                Phone = values.PhoneNumber,
                UserName = values.UserName
            };

            return View(UserEdit);
        }

        [HttpPost]
        public async Task<IActionResult> Index(UserEditDto userEditDto)
        {
            if (userEditDto.Password == userEditDto.ConfPassword)
            {
                var user = await _userManager.FindByNameAsync(User.Identity.Name);
                user.Name = userEditDto.Name;
                user.SurName = userEditDto.Surname;
                user.PhoneNumber = userEditDto.Phone;
                user.UserName = userEditDto.UserName;
                user.PasswordHash = _userManager.PasswordHasher.HashPassword(user, userEditDto.ConfPassword);


                if (user.Email == userEditDto.Mail)
                {
                    if (!user.EmailConfirmed)
                    {
                        SendMail(userEditDto.Mail, userEditDto.Name + " " + userEditDto.Surname);
                    }

                    var result = await _userManager.UpdateAsync(user);
                    user.Email = userEditDto.Mail;
                    if (result.Succeeded) 
                    {
                        return RedirectToAction("Index");
                    }
                }
                else
                {
                    user.EmailConfirmed = false;
                    user.Email = userEditDto.Mail;
                    SendMail(userEditDto.Mail, userEditDto.Name + " " + userEditDto.Surname);
                    var result = await _userManager.UpdateAsync(user);
                    if (result.Succeeded)
                    {
                        return RedirectToAction("Index");
                    }
                }

                return RedirectToAction("Index");

            }

            return View();
        }

        public static void SendMail(string AliciMail, string Ad_Soyad)
        {
            string outp = string.Empty;
            var Base64Mail = Encoding.UTF8.GetBytes(AliciMail);
            outp = Convert.ToBase64String(Base64Mail);


            MimeMessage mimeMessage = new MimeMessage();
            MailboxAddress mailboxAddressFrom = new MailboxAddress("Çokkeçeci Yazılım", "cokkececibbva@gmail.com");
            MailboxAddress mailboxAddressTo = new MailboxAddress("User", AliciMail);

            mimeMessage.From.Add(mailboxAddressFrom);
            mimeMessage.To.Add(mailboxAddressTo);

            var bodyBuilder = new BodyBuilder();
            bodyBuilder.HtmlBody = "<!doctype html>\r\n<html>\r\n<head>\r\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\r\n    <meta content='width=device-width, initial-scale=1.0' name='viewport'>\r\n    <style type=\"text/css\">\r\n        body {\r\n            -webkit-text-size-adjust: 100%;\r\n            -ms-text-size-adjust: 100%;\r\n            margin: 0 !important;\r\n            padding: 0 !important;\r\n        }\r\n\r\n        a[x-apple-data-detectors] {\r\n            color: inherit !important;\r\n            text-decoration: none !important;\r\n            font-size: inherit !important;\r\n            font-family: inherit !important;\r\n            font-weight: inherit !important;\r\n            line-height: inherit !important;\r\n        }\r\n\r\n        .mobilemenu a {\r\n            color: #ffffff;\r\n            text-decoration: none;\r\n        }\r\n\r\n        @@media only screen and (max-width: 768px) {\r\n            .blue {\r\n                background-color: #0980d2;\r\n            }\r\n\r\n            .border-none {\r\n                border: none !important;\r\n            }\r\n\r\n            .xs-block {\r\n                display: block !important;\r\n            }\r\n\r\n            .text-center {\r\n                text-align: center !important;\r\n            }\r\n\r\n            .goster {\r\n                overflow: visible !important;\r\n                max-height: 219px !important;\r\n            }\r\n\r\n            .mobile-lineheight {\r\n                line-height: 15px !important;\r\n            }\r\n        }\r\n\r\n        @@media only screen and (max-width: 640px) {\r\n            .mobilelogo {\r\n                display: block !important;\r\n                text-align: center !important;\r\n                padding-bottom: 20px !important\r\n            }\r\n\r\n            .mobilemenu {\r\n                display: block !important;\r\n                width: 100% !important;\r\n            }\r\n\r\n            .xspr15 {\r\n                padding-right: 15px !important;\r\n            }\r\n\r\n            .xspad15 {\r\n                padding-right: 15px !important;\r\n                padding-left: 15px !important;\r\n            }\r\n\r\n            .xspl15 {\r\n                padding-left: 15px !important;\r\n            }\r\n\r\n            .xspadmenu {\r\n                padding-right: 0px !important;\r\n            }\r\n        }\r\n\r\n        @@media only screen and (max-width: 650px) {\r\n            .hidden-xs {\r\n                display: none !important;\r\n            }\r\n\r\n            .xs-pr30 {\r\n                padding-left: 30px !important;\r\n            }\r\n\r\n            .xs-pr30 {\r\n                padding-right: 30px !important;\r\n            }\r\n\r\n            .table-responsive {\r\n                width: 100%;\r\n            }\r\n\r\n            .img-responsive {\r\n                max-width: 100%;\r\n                height: auto;\r\n            }\r\n\r\n            #footer-table {\r\n                width: 100% !important;\r\n            }\r\n        }\r\n\r\n        @@media (min-width: 321px) and (max-width: 425px) {\r\n            .mobilemenu {\r\n                padding-right: 0px !important;\r\n            }\r\n\r\n                .mobilemenu table {\r\n                    margin: 0 auto !important;\r\n                    width: 90% !important;\r\n                    text-align: center !important;\r\n                    float: none !important;\r\n                }\r\n        }\r\n\r\n        @@media (min-width: 650px) and (max-width: 768px) {\r\n            .hidden-sm {\r\n                display: none !important;\r\n            }\r\n\r\n            .table-responsive {\r\n                width: 640px;\r\n            }\r\n        }\r\n\r\n        @@media (max-width: 768px) {\r\n            .detail-button {\r\n                width: 100% !important;\r\n                padding: 15px 0px !important;\r\n                float: left;\r\n                text-align: center;\r\n            }\r\n\r\n            .color-white a {\r\n                color: #ffffff;\r\n            }\r\n        }\r\n\r\n        @@media (max-width: 424px) {\r\n            .mobilemenu a {\r\n                color: #ffffff;\r\n                text-decoration: none;\r\n            }\r\n\r\n            .smalltext {\r\n                font-size: 12px !important;\r\n            }\r\n\r\n            .xspr15 {\r\n                padding-right: 10px !important;\r\n            }\r\n\r\n            .xspad15 {\r\n                padding-right: 8px !important;\r\n                padding-left: 8px !important;\r\n            }\r\n\r\n            .xspl15 {\r\n                padding-left: 10px !important;\r\n            }\r\n\r\n            .xsmenupad1 {\r\n                padding-right: 10px !important\r\n            }\r\n\r\n            .xsmenupad2 {\r\n                padding-left: 10px !important;\r\n                padding-right: 10px !important\r\n            }\r\n\r\n            .xsmenupad3 {\r\n                padding-left: 10px !important\r\n            }\r\n        }\r\n    </style>\r\n    <title>Yapı Kredi</title>\r\n</head>\r\n<body marginheight=\"0\" marginwidth=\"0\" leftmargin=\"0\" topmargin=\"0\" bgcolor=\"#ffffff\">\r\n    <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" width=\"900\" align=\"center\" bgcolor=\"#0881d4\" class=\"table-responsive\">\r\n        <tr>\r\n            <td style=\"vertical-align:top;line-height:0px; font-size:0px;\">\r\n                <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" align=\"center\">\r\n                    <tr>\r\n                        <td style=\"padding-top:50px;padding-bottom:25px;\">\r\n                            <table class=\"table-responsive\" width=\"660\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\">\r\n                                <tr>\r\n                                    <td class=\"mobilelogo\" style=\"vertical-align:top;line-height:0px; font-size:0px;\"><a href=\"https://localhost:7229/Default/Index\" target=\"_blank\"><img class=\"img-responsive\" src=\"https://mailimg.yapikredi.com.tr/www/mail/EMAIL_VERIFY/images/logo.jpg\" alt=\"\" width=\"167\" height=\"30\" border=\"0\" /></a></td>\r\n                                    <td class=\"mobilemenu\" style=\"width:373px;\">\r\n                                        <table class=\"smalltext\" align=\"right\" style=\"color:#ffffff;font-family:Arial, Helvetica, sans-serif;font-size:14px;line-height:20px;\" cellpadding=\"0\" cellspacing=\"0\">\r\n                                            <tr>\r\n                                                <td class=\"xsmenupad1\" style=\"padding-right:20px;border-right:1px solid #399add;\">0533 038 08 30</td>\r\n                                                <td class=\"xsmenupad2\" style=\"padding-right:20px;padding-left:20px;border-right:1px solid #399add;\">444 0 444</td>\r\n                                                <td class=\"xspadmenu xsmenupad3\" style=\"padding-left:20px;padding-right:0px;\"><a style=\"color:#ffffff;text-decoration:none\" href=\"https://www.yapikredi.com.tr/\" target=\"_blank\">cokkececichef.com.tr</a></td>\r\n                                            </tr>\r\n                                           \r\n                                        </table>\r\n                                    </td>\r\n                                </tr>\r\n                            </table>\r\n                        </td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>\r\n                            <table width=\"640\" class=\" table-responsive border-none\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\">\r\n\r\n\r\n                                <tr>\r\n                                    <td bgcolor=\"#ffffff\" class=\"xstext\" valign=\"top\" style=\"padding-top:15px;padding-bottom:5px;padding-left:30px;padding-right:30px;color:#094190;font-family:Arial, Helvetica, sans-serif;font-size:15px;line-height:22px;text-align:left;\" width=\"640\">\r\n                                        <strong>Sayın " + Ad_Soyad + ",</strong>\r\n                                        <br /><br />\r\n                                        Bu e-posta, bilgilerinizin doğruluğunu ve güvenliğini sağlamak amacıyla gönderilmektedir. E-posta iletişimlerinizde kesinti yaşanmaması için bu adresinizi teyit etmenizi rica ederiz.\r\n                                        <br /> <br />\r\n                                        E-posta adresi size aitse <strong>«E-posta Adresimi Doğruluyorum»</strong> bağlantısına, e-posta adresinde hata olduğunu düşünüyorsanız adresin kayıtlarımızdan silinmesi için\r\n                                        <strong>«E-posta Kaydını Sil»</strong> bağlantısına tıklayabilirsiniz.\r\n                                    </td>\r\n                                    \r\n                                </tr>\r\n                                <tr bgcolor=\"#ffffff\" class=\"xstext\" valign=\"top\" style=\"padding-top:15px;padding-bottom:5px;padding-left:30px;padding-right:30px;color:#094190;font-family:Arial, Helvetica, sans-serif;font-size:15px;line-height:22px;text-align:left;\" width=\"640\">\r\n                                    <td bgcolor=\"#ffffff\" valign=\"top\" style=\"padding-top:15px;padding-bottom:5px;padding-left:30px;padding-right:30px;color:#094190;font-family:Arial,Helvetica,sans-serif;font-size:15px;line-height:22px;text-align:left;vertical-align:top\" width=\"320\">\r\n                                        <a href=\"https://localhost:7229/Setting/ConfirmMail?EmailAdress="+outp+"\" style=\"text-decoration:underline;font-weight:bold;color:#094190\" > <strong>E-posta Adresimi Doğruluyorum</strong></a>\r\n                                    </td>>\r\n\r\n                                    </td>\r\n                                </tr>\r\n\r\n                                <tr bgcolor=\"#ffffff\" class=\"xstext\" valign=\"top\" style=\"padding-top:15px;padding-bottom:5px;padding-left:30px;padding-right:30px;color:#094190;font-family:Arial, Helvetica, sans-serif;font-size:15px;line-height:22px;text-align:left;\" width=\"640\">\r\n                                    <td style=\"padding-top:15px;padding-left:30px;padding-right:20px;color:#094190;font-family:Arial,Helvetica,sans-serif;font-size:11px;line-height:15px;text-align:left\">\r\n                                        Sistemimizde kayıtlı e-posta bilgilerinizin güncel olması gerektiğini hatırlatırız. Bilgi güncelleme işlemlerinizi dilediğiniz zaman Çokkeçeci Chef Mobil'den, İnternet Şubesi'nden ya da Müşteri İletişim Merkezimizi arayarak gerçekleştirebilirsiniz. Restorantımız talebiniz olmadan size link göndererek şifrenizi istemez.\r\n                                    </td>\r\n                                </tr>\r\n\r\n\r\n                                <tr height=\"20\">\r\n                                    <td style=\"background-color:#FFFFFF;\">&nbsp;</td>\r\n                                </tr>\r\n\r\n                            </table>\r\n                        </td>\r\n                    </tr>\r\n                </table>\r\n            </td>\r\n        </tr>\r\n        <tr style=\"text-align:center;\">\r\n            <td style=\"padding-bottom:30px;padding-top:30px;\" bgcolor=\"#0881d4\">\r\n                <table class=\" border-none\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" bgcolor=\"#0881d4\">\r\n                    <tr>\r\n                        <td class=\"xspr15\" style=\"vertical-align:top;line-height:0px; font-size:0px;padding-right:30px;border-right:1px solid #399add;\"><a href=\"https://www.facebook.com/YapiKredi\" target=\"_blank\"><img src=\"https://mailimg.yapikredi.com.tr/www/mail/EMAIL_VERIFY/images/face.jpg\" alt=\"\" width=\"10\" height=\"20\" border=\"0\" /></a></td>\r\n                        <td class=\"xspad15\" style=\"vertical-align:top;line-height:0px; font-size:0px;padding-right:30px;padding-left:30px;border-right:1px solid #399add;\"><a href=\"https://twitter.com/burak_cokkececi\" target=\"_blank\"><img src=\"https://mailimg.yapikredi.com.tr/www/mail/EMAIL_VERIFY/images/twit.jpg\" alt=\"\" width=\"25\" height=\"20\" border=\"0\" /></a></td>\r\n                        <td class=\"xspad15\" style=\"vertical-align:top;line-height:0px; font-size:0px;padding-right:30px;padding-left:30px;border-right:1px solid #399add;\"><a href=\"https://www.instagram.com/burak_cokkececi/\" target=\"_blank\"><img src=\"https://mailimg.yapikredi.com.tr/www/mail/EMAIL_VERIFY/images/insta.jpg\" alt=\"\" width=\"20\" height=\"20\" border=\"0\" /></a></td>\r\n                        <td class=\"xspad15\" style=\"vertical-align:top;line-height:0px; font-size:0px;padding-right:30px;padding-left:30px;border-right:1px solid #399add;\"><a href=\"https://www.youtube.com/user/YapiKrediTV\" target=\"_blank\"><img src=\"https://mailimg.yapikredi.com.tr/www/mail/EMAIL_VERIFY/images/youtube.jpg\" alt=\"\" width=\"29\" height=\"20\" border=\"0\" /></a></td>\r\n                        <td class=\"xspl15\" style=\"vertical-align:top;line-height:0px; font-size:0px;padding-left:30px;\"><a href=\"https://localhost:7229/Default/Index\" target=\"_blank\"><img src=\"https://mailimg.yapikredi.com.tr/www/mail/EMAIL_VERIFY/images/writeus.jpg\" alt=\"\" width=\"158\" height=\"20\" border=\"0\" /></a></td>\r\n                    </tr>\r\n                </table>\r\n            </td>\r\n        </tr>\r\n        <tr>\r\n            <td colspan=\"3\" align=\"center\" bgcolor=\"#2058a6\" style=\"font-family:Arial, Helvetica, sans-serif; font-size:11px;line-height:16px; color:#ffffff; padding:0 50px;\">\r\n                <br />\r\n                <span class=\"color-white\">\r\n\r\n                    Bu e-posta bilgilendirme amaçlı gönderilmiştir. Lütfen yanıtlamayınız. E-postada adı geçen kişi siz değilseniz, en yakın şubemiz ile iletişime geçmenizi rica ederiz.\r\n                    Lütfen size gelen e-postaları Spam (Junk) mail olarak işaretlemeyiniz. <br />\r\n                    Kampanyalarla ilgili e-posta almak istemiyorsanız lütfen <a href=\"#\"> <font style=\"font-family:Arial, Helvetica, sans-serif; font-size:11px; color:#ffffff; font-weight:bold;\">tıklayınız.</font> </a> <br />\r\n                    <strong>Çokkeçci Yazılım A.Ş.</strong> - Battalgazi Mah. Demircioğlu Sok. Gelincik Sit. A Blok Melikgazi 38050 Battalgazi - Kayseri <br />\r\n                    Mersis no: 0937002089200741\r\n                </span> <br />\r\n                <br />\r\n            </td>\r\n        </tr>\r\n    </table>\r\n</body>\r\n</html>\r\n\r\n";

            mimeMessage.Body = bodyBuilder.ToMessageBody();

            mimeMessage.Subject = "Mail Aktivasyon İşlemi";
            SmtpClient smtpClient = new SmtpClient();
            smtpClient.Connect("smtp.gmail.com", 587, false);
            smtpClient.Authenticate("cokkececibbva@gmail.com", "fhbwiirrctprzmbu");
            smtpClient.Send(mimeMessage);
            smtpClient.Disconnect(true);
        }

        public async Task<IActionResult> ConfirmMail(string EmailAdress)
        {
            if (EmailAdress != null)
            {
                byte[] coz = System.Convert.FromBase64String(EmailAdress);
                string CozulmusMailAdresi = ASCIIEncoding.ASCII.GetString(coz);

                var user = await _userManager.FindByNameAsync(User.Identity.Name);

                if (user.Email == CozulmusMailAdresi)
                {
                    if (!user.EmailConfirmed)
                    {
                        user.EmailConfirmed = true;
                        TempData["EmailConfirmed"] = true;

                        var result = await _userManager.UpdateAsync(user);

                        if (result.Succeeded)
                        {
                            MimeMessage mimeMessage = new MimeMessage();
                            MailboxAddress mailboxAddressFrom = new MailboxAddress("Çokkeçeci Yazılım", "cokkececibbva@gmail.com");
                            MailboxAddress mailboxAddressTo = new MailboxAddress("User", CozulmusMailAdresi);

                            mimeMessage.From.Add(mailboxAddressFrom);
                            mimeMessage.To.Add(mailboxAddressTo);

                            var bodyBuilder = new BodyBuilder();
                            bodyBuilder.HtmlBody = "\r\n\r\n<!doctype html>\r\n<html>\r\n<head>\r\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\r\n    <meta content='width=device-width, initial-scale=1.0' name='viewport'>\r\n    <style type=\"text/css\">\r\n        body {\r\n            -webkit-text-size-adjust: 100%;\r\n            -ms-text-size-adjust: 100%;\r\n            margin: 0 !important;\r\n            padding: 0 !important;\r\n        }\r\n\r\n        a[x-apple-data-detectors] {\r\n            color: inherit !important;\r\n            text-decoration: none !important;\r\n            font-size: inherit !important;\r\n            font-family: inherit !important;\r\n            font-weight: inherit !important;\r\n            line-height: inherit !important;\r\n        }\r\n\r\n        .mobilemenu a {\r\n            color: #ffffff;\r\n            text-decoration: none;\r\n        }\r\n\r\n        @@media only screen and (max-width: 768px) {\r\n            .blue {\r\n                background-color: #0980d2;\r\n            }\r\n\r\n            .border-none {\r\n                border: none !important;\r\n            }\r\n\r\n            .xs-block {\r\n                display: block !important;\r\n            }\r\n\r\n            .text-center {\r\n                text-align: center !important;\r\n            }\r\n\r\n            .goster {\r\n                overflow: visible !important;\r\n                max-height: 219px !important;\r\n            }\r\n\r\n            .mobile-lineheight {\r\n                line-height: 15px !important;\r\n            }\r\n        }\r\n\r\n        @@media only screen and (max-width: 640px) {\r\n            .mobilelogo {\r\n                display: block !important;\r\n                text-align: center !important;\r\n                padding-bottom: 20px !important\r\n            }\r\n\r\n            .mobilemenu {\r\n                display: block !important;\r\n                width: 100% !important;\r\n            }\r\n\r\n            .xspr15 {\r\n                padding-right: 15px !important;\r\n            }\r\n\r\n            .xspad15 {\r\n                padding-right: 15px !important;\r\n                padding-left: 15px !important;\r\n            }\r\n\r\n            .xspl15 {\r\n                padding-left: 15px !important;\r\n            }\r\n\r\n            .xspadmenu {\r\n                padding-right: 0px !important;\r\n            }\r\n        }\r\n\r\n        @@media only screen and (max-width: 650px) {\r\n            .hidden-xs {\r\n                display: none !important;\r\n            }\r\n\r\n            .xs-pr30 {\r\n                padding-left: 30px !important;\r\n            }\r\n\r\n            .xs-pr30 {\r\n                padding-right: 30px !important;\r\n            }\r\n\r\n            .table-responsive {\r\n                width: 100%;\r\n            }\r\n\r\n            .img-responsive {\r\n                max-width: 100%;\r\n                height: auto;\r\n            }\r\n\r\n            #footer-table {\r\n                width: 100% !important;\r\n            }\r\n        }\r\n\r\n        @@media (min-width: 321px) and (max-width: 425px) {\r\n            .mobilemenu {\r\n                padding-right: 0px !important;\r\n            }\r\n\r\n                .mobilemenu table {\r\n                    margin: 0 auto !important;\r\n                    width: 90% !important;\r\n                    text-align: center !important;\r\n                    float: none !important;\r\n                }\r\n        }\r\n\r\n        @@media (min-width: 650px) and (max-width: 768px) {\r\n            .hidden-sm {\r\n                display: none !important;\r\n            }\r\n\r\n            .table-responsive {\r\n                width: 640px;\r\n            }\r\n        }\r\n\r\n        @@media (max-width: 768px) {\r\n            .detail-button {\r\n                width: 100% !important;\r\n                padding: 15px 0px !important;\r\n                float: left;\r\n                text-align: center;\r\n            }\r\n\r\n            .color-white a {\r\n                color: #ffffff;\r\n            }\r\n        }\r\n\r\n        @@media (max-width: 424px) {\r\n            .mobilemenu a {\r\n                color: #ffffff;\r\n                text-decoration: none;\r\n            }\r\n\r\n            .smalltext {\r\n                font-size: 12px !important;\r\n            }\r\n\r\n            .xspr15 {\r\n                padding-right: 10px !important;\r\n            }\r\n\r\n            .xspad15 {\r\n                padding-right: 8px !important;\r\n                padding-left: 8px !important;\r\n            }\r\n\r\n            .xspl15 {\r\n                padding-left: 10px !important;\r\n            }\r\n\r\n            .xsmenupad1 {\r\n                padding-right: 10px !important\r\n            }\r\n\r\n            .xsmenupad2 {\r\n                padding-left: 10px !important;\r\n                padding-right: 10px !important\r\n            }\r\n\r\n            .xsmenupad3 {\r\n                padding-left: 10px !important\r\n            }\r\n        }\r\n    </style>\r\n    <title>Yapı Kredi</title>\r\n</head>\r\n<body marginheight=\"0\" marginwidth=\"0\" leftmargin=\"0\" topmargin=\"0\" bgcolor=\"#ffffff\">\r\n    <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" width=\"900\" align=\"center\" bgcolor=\"#0881d4\" class=\"table-responsive\">\r\n        <tr>\r\n            <td style=\"vertical-align:top;line-height:0px; font-size:0px;\">\r\n                <table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" align=\"center\">\r\n                    <tr>\r\n                        <td style=\"padding-top:50px;padding-bottom:25px;\">\r\n                            <table class=\"table-responsive\" width=\"660\" align=\"center\" cellpadding=\"0\" cellspacing=\"0\">\r\n                                <tr>\r\n                                    <td class=\"mobilelogo\" style=\"vertical-align:top;line-height:0px; font-size:0px;\"><a href=\"https://www.yapikredi.com.tr/\" target=\"_blank\"><img class=\"img-responsive\" src=\"https://mailimg.yapikredi.com.tr/www/mail/EMAIL_VERIFY/images/logo.jpg\" alt=\"\" width=\"167\" height=\"30\" border=\"0\" /></a></td>\r\n                                    <td class=\"mobilemenu\" style=\"width:373px;\">\r\n                                        <table class=\"smalltext\" align=\"right\" style=\"color:#ffffff;font-family:Arial, Helvetica, sans-serif;font-size:14px;line-height:20px;\" cellpadding=\"0\" cellspacing=\"0\">\r\n                                            <tr>\r\n                                                <td class=\"xsmenupad1\" style=\"padding-right:20px;border-right:1px solid #399add;\">0850 222 0 444</td>\r\n                                                <td class=\"xsmenupad2\" style=\"padding-right:20px;padding-left:20px;border-right:1px solid #399add;\">444 0 444</td>\r\n                                                <td class=\"xspadmenu xsmenupad3\" style=\"padding-left:20px;padding-right:0px;\"><a style=\"color:#ffffff;text-decoration:none\" href=\"https://www.yapikredi.com.tr/\" target=\"_blank\">yapikredi.com.tr</a></td>\r\n                                            </tr>\r\n                                        </table>\r\n                                    </td>\r\n                                </tr>\r\n                            </table>\r\n                        </td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>\r\n                            <table width=\"640\" class=\" table-responsive border-none\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\">\r\n\r\n\r\n                                <tr>\r\n                                    <td bgcolor=\"#ffffff\" class=\"xstext\" valign=\"top\" style=\"padding-top:15px;padding-bottom:5px;padding-left:30px;padding-right:30px;color:#094190;font-family:Arial, Helvetica, sans-serif;font-size:15px;line-height:22px;text-align:left;\" width=\"640\">\r\n                                        E-posta adresiniz doğrulanmıştır.\r\n                                        <br>\r\n                                        Teşekkür ederiz.\r\n\r\n\r\n                                    </td>\r\n                                </tr>\r\n\r\n\r\n                                <tr height=\"20\">\r\n                                    <td style=\"background-color:#FFFFFF;\">&nbsp;</td>\r\n                                </tr>\r\n\r\n                            </table>\r\n                        </td>\r\n                    </tr>\r\n                </table>\r\n            </td>\r\n        </tr>\r\n        <tr style=\"text-align:center;\">\r\n            <td style=\"padding-bottom:30px;padding-top:30px;\" bgcolor=\"#0881d4\">\r\n                <table class=\" border-none\" cellpadding=\"0\" cellspacing=\"0\" align=\"center\" bgcolor=\"#0881d4\">\r\n                    <tr>\r\n                        <td class=\"xspr15\" style=\"vertical-align:top;line-height:0px; font-size:0px;padding-right:30px;border-right:1px solid #399add;\"><a href=\"https://www.facebook.com/YapiKredi\" target=\"_blank\"><img src=\"https://mailimg.yapikredi.com.tr/www/mail/EMAIL_VERIFY/images/face.jpg\" alt=\"\" width=\"10\" height=\"20\" border=\"0\" /></a></td>\r\n                        <td class=\"xspad15\" style=\"vertical-align:top;line-height:0px; font-size:0px;padding-right:30px;padding-left:30px;border-right:1px solid #399add;\"><a href=\"https://twitter.com/YapiKredi\" target=\"_blank\"><img src=\"https://mailimg.yapikredi.com.tr/www/mail/EMAIL_VERIFY/images/twit.jpg\" alt=\"\" width=\"25\" height=\"20\" border=\"0\" /></a></td>\r\n                        <td class=\"xspad15\" style=\"vertical-align:top;line-height:0px; font-size:0px;padding-right:30px;padding-left:30px;border-right:1px solid #399add;\"><a href=\"https://www.instagram.com/yapikredi/\" target=\"_blank\"><img src=\"https://mailimg.yapikredi.com.tr/www/mail/EMAIL_VERIFY/images/insta.jpg\" alt=\"\" width=\"20\" height=\"20\" border=\"0\" /></a></td>\r\n                        <td class=\"xspad15\" style=\"vertical-align:top;line-height:0px; font-size:0px;padding-right:30px;padding-left:30px;border-right:1px solid #399add;\"><a href=\"https://www.youtube.com/user/YapiKrediTV\" target=\"_blank\"><img src=\"https://mailimg.yapikredi.com.tr/www/mail/EMAIL_VERIFY/images/youtube.jpg\" alt=\"\" width=\"29\" height=\"20\" border=\"0\" /></a></td>\r\n                        <td class=\"xspl15\" style=\"vertical-align:top;line-height:0px; font-size:0px;padding-left:30px;\"><a href=\"https://www.yapikredi.com.tr/memnuniyetiniz-icin-buradayiz/bize-yazin.aspx\" target=\"_blank\"><img src=\"https://mailimg.yapikredi.com.tr/www/mail/EMAIL_VERIFY/images/writeus.jpg\" alt=\"\" width=\"158\" height=\"20\" border=\"0\" /></a></td>\r\n                    </tr>\r\n                </table>\r\n            </td>\r\n        </tr>\r\n        <tr>\r\n            <td colspan=\"3\" align=\"center\" bgcolor=\"#2058a6\" style=\"font-family:Arial, Helvetica, sans-serif; font-size:11px;line-height:16px; color:#ffffff; padding:0 50px;\">\r\n                <br />\r\n                <span class=\"color-white\">\r\n\r\n                    Lütfen size gelen e-postaları Spam (Junk) mail olarak işaretlemeyiniz. <br />\r\n                    Kampanyalarla ilgili e-posta almak istemiyorsanız lütfen <a href=\"#\"> <font style=\"font-family:Arial, Helvetica, sans-serif; font-size:11px; color:#ffffff; font-weight:bold;\">tıklayınız.</font> </a> <br />\r\n                    <strong>Yapı ve Kredi Bankası A.Ş.</strong> - Büyükdere Caddesi Yapı Kredi Plaza D Blok Levent 34330 Beşiktaş - İstanbul <br />\r\n                    Mersis no: 0937002089200741\r\n                </span> <br />\r\n                <br />\r\n            </td>\r\n        </tr>\r\n    </table>\r\n</body>\r\n</html>\r\n";

                            mimeMessage.Body = bodyBuilder.ToMessageBody();

                            mimeMessage.Subject = "Mail Adresiniz Doğrulanmıştır - Teşekkürler";
                            SmtpClient smtpClient = new SmtpClient();
                            smtpClient.Connect("smtp.gmail.com", 587, false);
                            smtpClient.Authenticate("cokkececibbva@gmail.com", "fhbwiirrctprzmbu");
                            smtpClient.Send(mimeMessage);
                            smtpClient.Disconnect(true);

                            return View();
                        }
                    }
                    else
                        TempData["EmailConfirmed"] = false;
                }
            }

            return View();
        }
    }
}
